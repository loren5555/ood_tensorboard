#!/bin/bash
# This script is sourced before script.sh is forked. Based on OOD's official example.
# We add: PATH (/opt), optional Lmod init, optional Conda activation, working_dir.

set -e

# --- (A) Export 'module' if present (same as official) ---
[[ $(type -t module) == "function" ]] && export -f module

# --- (B) Ensure Jupyter is on PATH (your system-wide venv under /opt) ---
export PATH="/opt/tensorboard/bin:$PATH"

# --- (F) Find an available port (official helper) ---
port=$(find_port)
password="$(create_passwd 16)"

# --- (K) Export connection secrets for the view (script.sh will emit them) ---
export port
export password